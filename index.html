<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù†Ø¸Ø§Ù… Ø§Ù„Ø¹Ø¯ÙŠØ¯ Ø§Ù„Ù…Ø±ÙƒØ²ÙŠ - Ù„ÙˆØ§Ø¡ 306</title>
    <style>
        :root { --main-color: #1b5e20; --edit-color: #f57c00; --archive-color: #c62828; }
        body { font-family: 'Segoe UI', Tahoma, sans-serif; background-color: #f4f4f9; margin: 0; padding: 0; direction: rtl; background-size: cover; background-attachment: fixed; }
        
        /* Ø§Ù„Ø­Ù…Ø§ÙŠØ© ÙˆØ§Ù„Ø¯Ø®ÙˆÙ„ */
        #loginPage { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: linear-gradient(135deg, #1b5e20, #000); display: flex; justify-content: center; align-items: center; z-index: 10000; }
        .login-card { background: white; padding: 40px; border-radius: 15px; width: 350px; text-align: center; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        .login-card input { width: 100%; padding: 12px; margin: 10px 0; border: 1px solid #ccc; border-radius: 6px; }

        /* Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© */
        .container { max-width: 1300px; margin: 20px auto; background: rgba(255, 255, 255, 0.95); padding: 25px; border-radius: 15px; box-shadow: 0 5px 25px rgba(0,0,0,0.2); position: relative; }
        .admin-only, .search-results { display: none; }
        
        /* Ø§Ø³ØªÙ…Ø§Ø±Ø© Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª (30 Ø­Ù‚Ù„) */
        .form-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 12px; }
        .form-grid div { display: flex; flex-direction: column; }
        label { font-size: 13px; font-weight: bold; margin-bottom: 4px; color: #444; }
        input, select, textarea { padding: 10px; border: 1px solid #ccc; border-radius: 5px; font-size: 14px; }
        textarea { grid-column: span 2; height: 60px; }

        /* Ø´Ø±ÙŠØ· Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª */
        .action-bar { background: #eee; padding: 20px; border-radius: 10px; margin: 20px 0; border: 2px solid var(--main-color); }
        .search-container { display: flex; gap: 10px; align-items: center; margin-bottom: 15px; }
        .btn-group { display: flex; gap: 8px; justify-content: center; flex-wrap: wrap; }
        .btn { border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; color: white; font-weight: bold; transition: 0.3s; }
        
        /* Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª ÙˆØ§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª */
        .fab-container { position: fixed; bottom: 20px; left: 20px; display: flex; gap: 15px; z-index: 999; }
        .fab { width: 60px; height: 60px; border-radius: 50%; border: none; cursor: pointer; font-size: 24px; color: white; box-shadow: 0 4px 15px rgba(0,0,0,0.3); }

        /* Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„ ÙˆØ§Ù„Ù…ÙˆØ¯Ø§Ù„ */
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.85); z-index: 2000; overflow-y: auto; }
        .modal-content { background: white; margin: 2% auto; padding: 30px; width: 90%; border-radius: 15px; position: relative; }
        .stat-card { background: #f9f9f9; padding: 20px; border-radius: 10px; border-top: 5px solid var(--main-color); text-align: center; }
        
        /* Ø§Ù„Ø¹Ù„Ø§Ù…Ø© Ø§Ù„Ù…Ø§Ø¦ÙŠØ© ÙÙŠ Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© */
        @media print {
            .no-print { display: none; }
            body { background: white !important; }
            .watermark-print { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%) rotate(-45deg); opacity: 0.1; font-size: 100px; z-index: -1; }
        }
    </style>
</head>
<body>

<div id="loginPage">
    <div class="login-card">
        <h2 style="color:var(--main-color)">Ù„ÙˆØ§Ø¡ 306 - Ø§Ù„Ø¯Ø®ÙˆÙ„</h2>
        <input type="text" id="uInp" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…">
        <input type="password" id="pInp" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
        <button onclick="login()" class="btn" style="background:var(--main-color); width:100%">Ø¯Ø®ÙˆÙ„ Ù„Ù„Ù†Ø¸Ø§Ù…</button>
        <div style="margin-top:10px; font-size:11px; color:#666">Ø§Ù„Ù…Ø¯ÙŠØ±: admin | Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯ÙŠÙ†: user1, user2, user3, user4</div>
    </div>
</div>

<div id="mainContent" style="display:none">
    <div class="container">
        <h2 id="formTitle" style="text-align:center; color:var(--main-color)">Ø§Ø³ØªÙ…Ø§Ø±Ø© Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ù†ØªØ³Ø¨ÙŠÙ† - Ø§Ù„Ø®Ø¯Ù…Ø© Ø§Ù„Ù†Ø´Ø·Ø©</h2>
        <form id="mainForm">
            <input type="hidden" id="editIndex" value="-1">
            <div class="form-grid">
                <div><label>ID</label><input type="text" id="idNo" required></div>
                <div><label>Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø±Ø¨Ø§Ø¹ÙŠ ÙˆØ§Ù„Ù„Ù‚Ø¨</label><input type="text" id="fullName" required></div>
                <div><label>Ø§Ù„Ù…ÙˆØ§Ù„ÙŠØ¯</label><input type="text" id="birthDate"></div>
                <div><label>Ù…Ø­Ù„ Ø§Ù„ØªÙˆÙ„Ø¯</label><input type="text" id="birthPlace"></div>
                <div><label>Ø§Ù„Ø¬Ù†Ø³</label><select id="gender"><option>Ø°ÙƒØ±</option><option>Ø£Ù†Ø«Ù‰</option></select></div>
                <div><label>Ø§Ø³Ù… Ø§Ù„Ø£Ù… Ø§Ù„Ø«Ù„Ø§Ø«ÙŠ</label><input type="text" id="motherName"></div>
                <div><label>Ø±Ù‚Ù… Ù‡ÙˆÙŠØ© Ø§Ù„Ø£Ø­ÙˆØ§Ù„/Ø§Ù„ÙˆØ·Ù†ÙŠØ©</label><input type="number" id="nationalId"></div>
                <div><label>Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø²ÙˆØ¬ÙŠØ©</label><select id="marital"><option>Ø£Ø¹Ø²Ø¨</option><option>Ù…ØªØ²ÙˆØ¬</option><option>Ù…Ø·Ù„Ù‚</option><option>Ø£Ø±Ù…Ù„</option></select></div>
                <div><label>Ø§Ø³Ù… Ø§Ù„Ø²ÙˆØ¬/Ø§Ù„Ø²ÙˆØ¬Ø©</label><input type="text" id="spouseName"></div>
                <div><label>Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø·ÙØ§Ù„</label><input type="number" id="children"></div>
                <div><label>Ø§Ù„ØªØ­ØµÙŠÙ„ Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠ</label><input type="text" id="edu"></div>
                <div><label>Ø§Ù„ØªØ®ØµØµ Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠ</label><input type="text" id="spec"></div>
                <div><label>Ø§Ù„Ø¹Ù…Ù„ Ø£Ùˆ Ø§Ù„ÙˆØ¸ÙŠÙØ©</label><input type="text" id="job"></div>
                <div><label>Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø©</label><input type="text" id="prov"></div>
                <div><label>Ø§Ù„Ù‚Ø¶Ø§Ø¡</label><input type="text" id="dist"></div>
                <div><label>Ø§Ù„Ù†Ø§Ø­ÙŠØ©</label><input type="text" id="subDist"></div>
                <div><label>Ø§Ù„Ù…Ù†Ø·Ù‚Ø©</label><input type="text" id="region"></div>
                <div><label>Ø§Ù„Ù…Ø­Ù„Ø©</label><input type="text" id="mahala"></div>
                <div><label>Ø§Ù„Ø²Ù‚Ø§Ù‚</label><input type="text" id="zuqaq"></div>
                <div><label>Ø§Ù„Ø¯Ø§Ø±</label><input type="text" id="dar"></div>
                <div><label>Ø£Ù‚Ø±Ø¨ Ù†Ù‚Ø·Ø© Ø¯Ø§Ù„Ø©</label><input type="text" id="landmark"></div>
                <div><label>Ø§Ù„Ù‡Ø§ØªÙ</label><input type="number" id="phone"></div>
                <div><label>Ø§Ù„Ù„ÙˆØ§Ø¡</label><input type="text" id="brigade" value="Ù„ÙˆØ§Ø¡ 306"></div>
                <div><label>Ø§Ù„ÙÙˆØ¬</label><select id="fowj"><option>Ø§Ù„Ø£ÙˆÙ„</option><option>Ø§Ù„Ø«Ø§Ù†ÙŠ</option><option>Ø§Ù„Ø«Ø§Ù„Ø«</option><option>Ø§Ù„Ø±Ø§Ø¨Ø¹</option><option>Ø§Ù„Ø®Ø§Ù…Ø³</option><option>Ø§Ù„Ø³Ø§Ø¯Ø³</option><option>Ø§Ù„Ø³Ø§Ø¨Ø¹</option></select></div>
                <div><label>Ø±Ù‚Ù… Ø§Ù„Ø³Ø±ÙŠØ©</label><select id="sariyaNum"></select></div>
                <div><label>Ø§Ù„ØµÙ†Ù</label><input type="text" id="category"></div>
                <div><label>Ø§Ù„Ø®Ø¨Ø±Ø§Øª Ø§Ù„Ø¹Ø³ÙƒØ±ÙŠØ©</label><input type="text" id="exp"></div>
                <div><label>Ø§Ù„Ù…Ø¹Ø±Ù</label><input type="text" id="refName"></div>
                <div><label>Ù‡Ø§ØªÙ Ø§Ù„Ù…Ø¹Ø±Ù</label><input type="number" id="refPhone"></div>
                <div><label>Ø§Ø³Ù… Ø§Ù„Ø³Ø±ÙŠØ©</label><input type="text" id="sariyaName"></div>
                <textarea id="notes" placeholder="Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„Ø¹Ø§Ù…Ø©..."></textarea>
            </div>
            <div class="admin-only" style="text-align:center; margin-top:20px;">
                <button type="submit" id="saveBtn" class="btn" style="background:var(--main-color); padding:15px 100px">Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</button>
            </div>
        </form>

        <div class="action-bar no-print">
            <div class="search-container">
                <input type="text" id="searchInput" placeholder="ğŸ” Ø§Ø¨Ø­Ø« Ø¨Ø§Ù„Ø§Ø³Ù… Ø£Ùˆ ID..." style="flex:1; padding:12px;">
                <button onclick="searchData()" class="btn" style="background:#444">Ø¨Ø­Ø«</button>
                <div class="admin-only">
                    <button onclick="document.getElementById('impFile').click()" class="btn" style="background:#0277bd">ğŸ“¥ Ø§Ø³ØªÙŠØ±Ø§Ø¯</button>
                    <button onclick="exportToExcel()" class="btn" style="background:#2e7d32">ğŸ“¤ ØªØµØ¯ÙŠØ±</button>
                    <input type="file" id="impFile" hidden accept=".csv" onchange="importCSV(this)">
                </div>
            </div>
            
            <div id="recordActions" class="btn-group" style="display:none;">
                <button onclick="preview()" class="btn" style="background:#0097a7">ğŸ‘ Ù…Ø¹Ø§ÙŠÙ†Ø©</button>
                <button onclick="printCard()" class="btn" style="background:#455a64">ğŸ–¨ Ø·Ø¨Ø§Ø¹Ø©</button>
                <div class="admin-only" style="display:inline-flex; gap:8px;">
                    <button onclick="editMode()" class="btn" style="background:var(--edit-color)">âœï¸ ØªØ¹Ø¯ÙŠÙ„</button>
                    <button onclick="deleteRecord()" class="btn" style="background:#d32f2f">ğŸ—‘ Ø­Ø°Ù</button>
                    <button onclick="moveToPenalty()" class="btn" style="background:black">âš–ï¸ Ø¹Ù‚ÙˆØ¨Ø©</button>
                </div>
            </div>
        </div>

        <div style="display:flex; justify-content: space-between; align-items: center; margin-top:30px;" class="no-print">
            <button onclick="togglePenaltyView()" id="penaltyToggleBtn" class="btn" style="background:var(--archive-color)">Ø§Ù†ØªÙ‚Ø§Ù„ Ø¥Ù„Ù‰ Ø³Ø¬Ù„ Ø§Ù„Ø¹Ù‚ÙˆØ¨Ø§Øª âš–ï¸</button>
            <div class="fab-container">
                <button class="fab admin-only" onclick="openModal('statsModal')" style="background:#673ab7" title="Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª">ğŸ“Š</button>
                <button class="fab admin-only" onclick="openModal('settingsModal')" style="background:#333" title="Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª">âš™ï¸</button>
            </div>
        </div>
    </div>
</div>

<div id="statsModal" class="modal">
    <div class="modal-content">
        <h2>ğŸ“Š Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ù„ÙˆØ§Ø¡ 306</h2>
        <div class="form-grid" id="statsGrid"></div>
        <button onclick="closeModal('statsModal')" class="btn" style="background:#444; margin-top:20px;">Ø¥ØºÙ„Ø§Ù‚</button>
    </div>
</div>

<div id="settingsModal" class="modal">
    <div class="modal-content" style="width:400px">
        <h3>âš™ï¸ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù…</h3>
        <div id="securitySet">
            <label>ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©</label><input type="password" id="oldP">
            <label>Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø¬Ø¯ÙŠØ¯</label><input type="text" id="newU">
            <label>ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©</label><input type="password" id="newP">
            <button onclick="updateAuth()" class="btn" style="background:var(--main-color); width:100%; margin:10px 0">ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ù…Ø§ÙŠØ©</button>
        </div>
        <hr>
        <label>ØªØºÙŠÙŠØ± Ø§Ù„Ù„ÙˆÙ† Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ (30 Ù„ÙˆÙ†)</label>
        <div id="colorPalette" style="display:grid; grid-template-columns:repeat(6,1fr); gap:5px; margin:10px 0"></div>
        <hr>
        <label>ØµÙˆØ±Ø© Ø§Ù„Ø®Ù„ÙÙŠØ©</label><input type="file" onchange="bgUpload(this, 'bg')">
        <label>ØµÙˆØ±Ø© Ø§Ù„Ø¹Ù„Ø§Ù…Ø© Ø§Ù„Ù…Ø§Ø¦ÙŠØ©</label><input type="file" onchange="bgUpload(this, 'wm')">
        <button onclick="closeModal('settingsModal')" class="btn" style="background:#444; width:100%">Ø­ÙØ¸ ÙˆØ¥ØºÙ„Ø§Ù‚</button>
    </div>
</div>

<script>
    let role = '';
    let currentView = 'active'; // active OR penalty
    let lastFoundIndex = -1;
    const fields = ["idNo","fullName","birthDate","birthPlace","gender","motherName","nationalId","marital","spouseName","children","edu","spec","job","prov","dist","subDist","region","mahala","zuqaq","dar","landmark","phone","brigade","fowj","sariyaNum","category","exp","refName","refPhone","notes","sariyaName"];

    // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª
    const sSel = document.getElementById('sariyaNum');
    for(let i=1; i<=40; i++) { let o = document.createElement('option'); o.value=i; o.text=i; sSel.appendChild(o); }

    // 1. Ù†Ø¸Ø§Ù… Ø§Ù„Ø¯Ø®ÙˆÙ„
    function login() {
        const u = document.getElementById('uInp').value;
        const p = document.getElementById('pInp').value;
        const users = { 'admin': '1234', 'user1': '1234', 'user2': '1234', 'user3': '1234', 'user4': '1234' };
        
        if(users[u] && users[u] === p) {
            role = (u === 'admin') ? 'admin' : 'assistant';
            document.getElementById('loginPage').style.display = 'none';
            document.getElementById('mainContent').style.display = 'block';
            if(role === 'admin') document.querySelectorAll('.admin-only').forEach(e => e.style.display = 'block');
            initSettings();
        } else alert("Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø®Ø§Ø·Ø¦Ø©!");
    }

    // 2. Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
    function searchData() {
        const val = document.getElementById('searchInput').value.trim();
        const db = JSON.parse(localStorage.getItem(currentView === 'active' ? 'db_306' : 'penalty_306') || '[]');
        const idx = db.findIndex(i => i.idNo == val || i.fullName.includes(val));
        
        if(idx > -1) {
            lastFoundIndex = idx;
            const item = db[idx];
            fields.forEach(f => { if(document.getElementById(f)) document.getElementById(f).value = item[f] || ''; });
            document.getElementById('recordActions').style.display = 'flex';
        } else {
            alert("Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ù†ØªØ§Ø¦Ø¬");
            document.getElementById('recordActions').style.display = 'none';
        }
    }

    document.getElementById('mainForm').onsubmit = function(e) {
        e.preventDefault();
        const db = JSON.parse(localStorage.getItem('db_306') || '[]');
        let data = {};
        fields.forEach(f => data[f] = document.getElementById(f).value);
        
        const editIdx = document.getElementById('editIndex').value;
        if(editIdx == "-1") db.push(data);
        else { db[editIdx] = data; document.getElementById('editIndex').value = "-1"; }
        
        localStorage.setItem('db_306', JSON.stringify(db));
        alert("ØªÙ… Ø§Ù„Ø­ÙØ¸");
        this.reset();
        document.getElementById('recordActions').style.display = 'none';
    };

    function togglePenaltyView() {
        currentView = (currentView === 'active') ? 'penalty' : 'active';
        document.getElementById('formTitle').innerText = (currentView === 'active') ? "Ø§Ø³ØªÙ…Ø§Ø±Ø© Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ù†ØªØ³Ø¨ÙŠÙ† - Ø§Ù„Ø®Ø¯Ù…Ø© Ø§Ù„Ù†Ø´Ø·Ø©" : "Ø³Ø¬Ù„ Ø§Ù„Ø¹Ù‚ÙˆØ¨Ø§Øª ÙˆØ§Ù„Ø£Ø±Ø´ÙŠÙ";
        document.getElementById('penaltyToggleBtn').innerText = (currentView === 'active') ? "Ø§Ù†ØªÙ‚Ø§Ù„ Ø¥Ù„Ù‰ Ø³Ø¬Ù„ Ø§Ù„Ø¹Ù‚ÙˆØ¨Ø§Øª âš–ï¸" : "Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ø®Ø¯Ù…Ø© Ø§Ù„Ù†Ø´Ø·Ø© âœ…";
        document.getElementById('mainForm').reset();
        document.getElementById('recordActions').style.display = 'none';
    }

    function moveToPenalty() {
        if(!confirm("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ù†Ù‚Ù„ Ø§Ù„Ø³Ø¬Ù„ Ù„Ù„Ø¹Ù‚ÙˆØ¨Ø§ØªØŸ")) return;
        let db = JSON.parse(localStorage.getItem('db_306'));
        let pen = JSON.parse(localStorage.getItem('penalty_306') || '[]');
        pen.push(db.splice(lastFoundIndex, 1)[0]);
        localStorage.setItem('db_306', JSON.stringify(db));
        localStorage.setItem('penalty_306', JSON.stringify(pen));
        location.reload();
    }

    // 3. Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
    function openModal(id) {
        if(id === 'statsModal') {
            const db = JSON.parse(localStorage.getItem('db_306') || '[]');
            const pen = JSON.parse(localStorage.getItem('penalty_306') || '[]');
            let html = `<div class="stat-card"><h3>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù„ÙˆØ§Ø¡</h3><h2>${db.length}</h2></div>`;
            ["Ø§Ù„Ø£ÙˆÙ„","Ø§Ù„Ø«Ø§Ù†ÙŠ","Ø§Ù„Ø«Ø§Ù„Ø«","Ø§Ù„Ø±Ø§Ø¨Ø¹","Ø§Ù„Ø®Ø§Ù…Ø³","Ø§Ù„Ø³Ø§Ø¯Ø³","Ø§Ù„Ø³Ø§Ø¨Ø¹"].forEach(f => {
                let count = db.filter(i => i.fowj === f).length;
                html += `<div class="stat-card"><h3>ÙÙˆØ¬ ${f}</h3><h2>${count}</h2></div>`;
            });
            html += `<div class="stat-card" style="border-color:black"><h3>Ø§Ù„Ø¹Ù‚ÙˆØ¨Ø§Øª</h3><h2>${pen.length}</h2></div>`;
            document.getElementById('statsGrid').innerHTML = html;
        }
        document.getElementById(id).style.display = 'block';
    }

    // 4. Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª ÙˆØ§Ù„Ø¬Ù…Ø§Ù„ÙŠØ©
    function initSettings() {
        const colors = ['#1b5e20','#2e7d32','#4b5320','#1a237e','#0d47a1','#01579b','#006064','#004d40','#bf360c','#b71c1c','#880e4f','#4a148c','#311b92','#212121','#37474f','#4e342e','#b8860b','#d4af37','#795548','#263238','#e91e63','#9c27b0','#673ab7','#3f51b5','#2196f3','#03a9f4','#00bcd4','#009688','#4caf50','#8bc34a'];
        const palette = document.getElementById('colorPalette');
        colors.forEach(c => {
            let d = document.createElement('div'); d.style.background = c; d.style.height='30px'; d.style.cursor='pointer';
            d.onclick = () => { document.documentElement.style.setProperty('--main-color', c); localStorage.setItem('306_color', c); };
            palette.appendChild(d);
        });
        if(localStorage.getItem('306_color')) document.documentElement.style.setProperty('--main-color', localStorage.getItem('306_color'));
        if(localStorage.getItem('306_bg')) document.body.style.backgroundImage = `url(${localStorage.getItem('306_bg')})`;
    }

    function bgUpload(input, type) {
        let reader = new FileReader();
        reader.onload = (e) => {
            if(type === 'bg') { document.body.style.backgroundImage = `url(${e.target.result})`; localStorage.setItem('306_bg', e.target.result); }
            else localStorage.setItem('306_wm', e.target.result);
        };
        reader.readAsDataURL(input.files[0]);
    }

    // 5. Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© ÙˆØ§Ù„ØªØµØ¯ÙŠØ±
    function printCard() {
        const wm = localStorage.getItem('306_wm');
        const win = window.open('', '_blank');
        win.document.write(`<html><head><style>body{direction:rtl; font-family:tahoma; padding:30px;} .wm{position:fixed; top:30%; left:20%; opacity:0.1; width:60%; z-index:-1;}</style></head><body>`);
        if(wm) win.document.write(`<img src="${wm}" class="wm">`);
        win.document.write(`<h1>Ù„ÙˆØ§Ø¡ 306 - Ø§Ø³ØªÙ…Ø§Ø±Ø© Ù…Ø¹Ù„ÙˆÙ…Ø§Øª</h1><hr><div style="display:grid; grid-template-columns:1fr 1fr; gap:20px">`);
        fields.forEach(f => {
            let label = document.querySelector(`label[for=${f}]`)?.innerText || f;
            win.document.write(`<p style="font-size:18px; border-bottom:1px solid #ccc"><b>${f}:</b> ${document.getElementById(f).value}</p>`);
        });
        win.document.write(`</div></body></html>`);
        win.document.close(); setTimeout(() => win.print(), 5
