<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ù†Ø¸Ø§Ù… Ø§Ù„Ø¹Ø¯ÙŠØ¯ Ø§Ù„Ù…Ø±ÙƒØ²ÙŠ - Ù„ÙˆØ§Ø¡ 306</title>
<style>
:root{--main:#1b5e20}
body{font-family:'Segoe UI',Tahoma;background:#0d1b16;margin:0;direction:rtl;color:#000}
.container{max-width:1200px;margin:20px auto;background:#fff;padding:25px;border-radius:15px}
.btn{padding:10px;border:none;border-radius:6px;cursor:pointer;color:#fff;font-weight:bold;transition:0.3s}
.btn-main{background:var(--main);width:100%}
.hidden{display:none}
input{padding:10px;width:100%;border:1px solid #ccc;border-radius:6px;margin-bottom:10px}

/* LOGIN */
#loginScreen{position:fixed;inset:0;background:rgba(0,0,0,.9);display:flex;justify-content:center;align-items:center;z-index:9999;padding:15px}
.login-box{background:#fff;width:100%;max-width:360px;padding:25px;border-radius:15px;text-align:center;box-shadow:0 10px 30px rgba(0,0,0,.4)}
.login-box h3{margin-bottom:15px;color:var(--main)}
#loginErr{display:none;background:#c62828;color:#fff;padding:8px;border-radius:6px;margin-top:10px;font-size:14px}

/* TABLE */
table{width:100%;border-collapse:collapse;margin-top:15px}
th,td{border:1px solid #ccc;padding:6px;text-align:center;font-size:13px}
th{background:#2e7d32;color:#fff}

/* MODALS */
.modal{position:fixed;inset:0;background:rgba(0,0,0,0.5);display:flex;justify-content:center;align-items:center;z-index:9999;padding:15px}
.modal-content{background:#fff;padding:20px;border-radius:12px;width:100%;max-width:400px}
.modal-content h3{margin-top:0}
.modal-close{background:#555;width:100%;margin-top:10px;border-radius:6px}
</style>
</head>
<body>

<!-- LOGIN SCREEN -->
<div id="loginScreen">
  <div class="login-box">
    <h3>ğŸ” ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</h3>
    <input id="loginUser" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…">
    <input id="loginPass" type="password" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
    <button class="btn btn-main" onclick="login()">Ø¯Ø®ÙˆÙ„</button>
    <div id="loginErr"></div>
  </div>
</div>

<!-- SYSTEM -->
<div class="container hidden" id="app">
  <h2 style="color:var(--main)">Ù†Ø¸Ø§Ù… Ø§Ù„Ø¹Ø¯ÙŠØ¯ Ø§Ù„Ù…Ø±ÙƒØ²ÙŠ - Ù„ÙˆØ§Ø¡ 306</h2>
  <p id="who"></p>
  <form onsubmit="saveData(event)">
    <input id="name" placeholder="Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„" required>
    <input id="nid" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù‡ÙˆÙŠØ©">
    <input id="phone" placeholder="Ø§Ù„Ù‡Ø§ØªÙ">
    <input id="fowj" placeholder="Ø§Ù„ÙÙˆØ¬">
    <button class="btn btn-main">ğŸ’¾ Ø­ÙØ¸</button>
  </form>
  <div style="margin-top:15px">
    <button onclick="showStats()" class="btn btn-main" style="background:#6a1b9a">ğŸ“Š Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª</button>
    <button onclick="logout()" class="btn btn-main" style="background:#444">ğŸšª ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬</button>
  </div>
  <table id="tbl"></table>
</div>

<!-- STATS MODAL -->
<div id="stats" class="modal hidden">
  <div class="modal-content">
    <div id="statsContent"></div>
    <button onclick="stats.classList.add('hidden')" class="btn modal-close">Ø¥ØºÙ„Ø§Ù‚</button>
  </div>
</div>

<script>
/* ===== USERS & PERMISSIONS ===== */
const USERS = [
  { u: "admin", p: "1234", r: "admin" },
  { u: "editor", p: "123", r: "editor" },
  { u: "viewer", p: "111", r: "viewer" }
];
let currentUser=null;

/* ===== LOGIN ===== */
function login() {
  const u = loginUser.value.trim();
  const p = loginPass.value.trim();
  const err = document.getElementById("loginErr");
  err.style.display = "none";

  if(!u||!p){
    err.innerText="ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙˆÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±";
    err.style.display="block"; return;
  }

  const f = USERS.find(x => x.u === u && x.p === p);
  if(!f){
    err.innerText="âŒ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯Ø®ÙˆÙ„ ØºÙŠØ± ØµØ­ÙŠØ­Ø©";
    err.style.display="block"; return;
  }

  currentUser=f;
  document.getElementById("loginScreen").style.display="none";
  document.getElementById("app").classList.remove("hidden");
  document.getElementById("who").innerText=`ğŸ‘¤ ${f.u} (${f.r})`;
  render();
}

/* ===== LOGOUT ===== */
function logout(){location.reload();}

/* ===== SAVE ===== */
function saveData(e){
  e.preventDefault();
  if(currentUser.r==="viewer"){alert("ØºÙŠØ± Ù…ØµØ±Ø­"); return;}

  let db=JSON.parse(localStorage.getItem("db306")||"[]");

  // Ù…Ù†Ø¹ Ø§Ù„ØªÙƒØ±Ø§Ø±
  if(db.some(x=>x.name===name.value && x.nid===nid.value && x.phone===phone.value)){
    alert("âŒ Ø³Ø¬Ù„ Ù…ÙƒØ±Ø±"); return;
  }

  db.push({
    name:name.value,
    nid:nid.value,
    phone:phone.value,
    fowj:fowj.value
  });

  localStorage.setItem("db306",JSON.stringify(db));
  e.target.reset();
  render();
}

/* ===== RENDER ===== */
function render(){
  let db=JSON.parse(localStorage.getItem("db306")||"[]");
  tbl.innerHTML=
    "<tr><th>Ø§Ù„Ø§Ø³Ù…</th><th>Ø§Ù„Ù‡ÙˆÙŠØ©</th><th>Ø§Ù„Ù‡Ø§ØªÙ</th><th>Ø§Ù„ÙÙˆØ¬</th></tr>"+
    db.map(x=>`<tr>
      <td>${x.name}</td>
      <td>${x.nid}</td>
      <td>${x.phone}</td>
      <td>${x.fowj}</td>
    </tr>`).join("");
}

/* ===== STATS ===== */
function showStats(){
  let db=JSON.parse(localStorage.getItem("db306")||"[]");
  let byF={};
  db.forEach(x=>byF[x.fowj]=(byF[x.fowj]||0)+1);
  let h=`<h3>ğŸ“Š Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª</h3><p>Ø§Ù„Ø¹Ø¯Ø¯ Ø§Ù„ÙƒÙ„ÙŠ: ${db.length}</p><ul>`;
  for(let k in byF) h+=`<li>${k||"ØºÙŠØ± Ù…Ø­Ø¯Ø¯"}: ${byF[k]}</li>`;
  h+="</ul>";
  statsContent.innerHTML=h;
  stats.classList.remove("hidden");
}
</script>

</body>
</html>
