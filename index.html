<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>Ù†Ø¸Ø§Ù… Ø§Ù„Ø¹Ø¯ÙŠØ¯ Ø§Ù„Ù…ØªØ·ÙˆØ± - Ù„ÙˆØ§Ø¡ 306</title>
    <style>
        :root { --main-color: #1b5e20; --edit-color: #f57c00; --archive-color: #c62828; }
        body { font-family: 'Segoe UI', Tahoma, sans-serif; background-color: #f4f4f9; margin: 0; padding: 0; direction: rtl; }
        
        /* ØªØ­Ø³ÙŠÙ† ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù„ØªÙƒÙˆÙ† Ø£ÙˆØ¶Ø­ Ù„Ù„Ù€ PC */
        #loginPage { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: linear-gradient(135deg, var(--main-color), #000); display: flex; justify-content: center; align-items: center; z-index: 10000; }
        .login-card { background: white; padding: 35px; border-radius: 15px; width: 340px; text-align: center; box-shadow: 0 10px 30px rgba(0,0,0,0.5); border: 2px solid #fff; }
        .login-card h2 { margin-bottom: 25px; color: var(--main-color); }
        .login-card input { width: 100%; padding: 12px; margin: 10px 0; border: 1px solid #ccc; border-radius: 6px; box-sizing: border-box; font-size: 16px; outline: none; }
        .login-card input:focus { border-color: var(--main-color); box-shadow: 0 0 5px rgba(27,94,32,0.3); }

        .container { max-width: 1300px; margin: 20px auto; background: rgba(255, 255, 255, 0.97); padding: 25px; border-radius: 15px; box-shadow: 0 5px 25px rgba(0,0,0,0.2); }
        .admin-only { display: none; }
        
        .form-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 12px; margin-bottom: 20px; }
        .form-grid div { display: flex; flex-direction: column; }
        label { font-size: 12px; font-weight: bold; margin-bottom: 4px; color: #555; }
        input, select, textarea { padding: 10px; border: 1px solid #ccc; border-radius: 5px; font-size: 14px; background: #fff; }
        
        .action-bar { background: #f0f0f0; padding: 20px; border-radius: 10px; margin: 20px 0; border: 2px solid var(--main-color); }
        .btn { border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; color: white; font-weight: bold; transition: 0.2s; }
        .btn:active { transform: scale(0.98); }

        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 20000; }
        .modal-content { background: white; margin: 5% auto; padding: 30px; width: 80%; border-radius: 15px; text-align: center; }
    </style>
</head>
<body>

<div id="loginPage">
    <div class="login-card">
        <h2>Ù†Ø¸Ø§Ù… Ø§Ù„Ø¹Ø¯ÙŠØ¯ Ø§Ù„Ù…Ø±ÙƒØ²ÙŠ</h2>
        <input type="text" id="uInp" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…">
        <input type="password" id="pInp" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
        <div style="text-align:right; font-size:13px; margin-bottom:15px;">
            <input type="checkbox" id="remMe"> ØªØ°ÙƒØ±Ù†ÙŠ Ø¹Ù„Ù‰ Ù‡Ø°Ø§ Ø§Ù„Ø¬Ù‡Ø§Ø²
        </div>
        <button id="entryBtn" class="btn" style="background:var(--main-color); width:100%; padding:14px; font-size:18px;">Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù†Ø¸Ø§Ù…</button>
        <p style="font-size: 11px; margin-top: 15px; color: #777;">Ø±Ù…Ø² Ø§Ù„Ø·ÙˆØ§Ø±Ø¦: RESET306</p>
    </div>
</div>

<div id="mainContent" style="display:none">
    <div class="container">
        <div style="display:flex; justify-content:space-between; align-items:center; border-bottom:2px solid var(--main-color); padding-bottom:10px;">
            <h2 id="viewTitle">Ø³Ø¬Ù„ Ø§Ù„Ø®Ø¯Ù…Ø© Ø§Ù„Ù†Ø´Ø·Ø© - Ù„ÙˆØ§Ø¡ 306</h2>
            <button onclick="logout()" class="btn" style="background:#c62828">ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬</button>
        </div>

        <form id="mainForm" style="margin-top:20px;">
            <input type="hidden" id="editIdx" value="-1">
            <div class="form-grid">
                <div><label>ID</label><input type="text" id="idNo" required></div>
                <div><label>Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø±Ø¨Ø§Ø¹ÙŠ ÙˆØ§Ù„Ù„Ù‚Ø¨</label><input type="text" id="fullName" required></div>
                <div><label>Ø§Ù„Ù…ÙˆØ§Ù„ÙŠØ¯</label><input type="text" id="birthDate"></div>
                <div><label>Ù…Ø­Ù„ Ø§Ù„ØªÙˆÙ„Ø¯</label><input type="text" id="birthPlace"></div>
                <div><label>Ø§Ù„Ø¬Ù†Ø³</label><select id="gender"><option>Ø°ÙƒØ±</option><option>Ø£Ù†Ø«Ù‰</option></select></div>
                <div><label>Ø§Ø³Ù… Ø§Ù„Ø£Ù… Ø§Ù„Ø«Ù„Ø§Ø«ÙŠ</label><input type="text" id="motherName"></div>
                <div><label>Ø±Ù‚Ù… Ø§Ù„Ù‡ÙˆÙŠØ© / Ø§Ù„ÙˆØ·Ù†ÙŠØ©</label><input type="number" id="natId"></div>
                <div><label>Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø²ÙˆØ¬ÙŠØ©</label><select id="marital"><option>Ø£Ø¹Ø²Ø¨</option><option>Ù…ØªØ²ÙˆØ¬</option><option>Ù…Ø·Ù„Ù‚</option><option>Ø£Ø±Ù…Ù„</option></select></div>
                <div><label>Ø§Ø³Ù… Ø§Ù„Ø²ÙˆØ¬/Ø§Ù„Ø²ÙˆØ¬Ø©</label><input type="text" id="spouse"></div>
                <div><label>Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø·ÙØ§Ù„</label><input type="number" id="kids"></div>
                <div><label>Ø§Ù„ØªØ­ØµÙŠÙ„ Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠ</label><input type="text" id="edu"></div>
                <div><label>Ø§Ù„ØªØ®ØµØµ Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠ</label><input type="text" id="spec"></div>
                <div><label>Ø§Ù„Ø¹Ù…Ù„ Ø£Ùˆ Ø§Ù„ÙˆØ¸ÙŠÙØ©</label><input type="text" id="job"></div>
                <div><label>Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø©</label><input type="text" id="prov"></div>
                <div><label>Ø§Ù„Ù‚Ø¶Ø§Ø¡</label><input type="text" id="dist"></div>
                <div><label>Ø§Ù„Ù†Ø§Ø­ÙŠØ©</label><input type="text" id="subDist"></div>
                <div><label>Ø§Ù„Ù…Ù†Ø·Ù‚Ø©</label><input type="text" id="region"></div>
                <div><label>Ø§Ù„Ù…Ø­Ù„Ø©</label><input type="text" id="mahala"></div>
                <div><label>Ø§Ù„Ø²Ù‚Ø§Ù‚</label><input type="text" id="zuqaq"></div>
                <div><label>Ø§Ù„Ø¯Ø§Ø±</label><input type="text" id="dar"></div>
                <div><label>Ø£Ù‚Ø±Ø¨ Ù†Ù‚Ø·Ø© Ø¯Ø§Ù„Ø©</label><input type="text" id="point"></div>
                <div><label>Ø§Ù„Ù‡Ø§ØªÙ</label><input type="number" id="phone"></div>
                <div><label>Ø§Ù„Ù„ÙˆØ§Ø¡</label><input type="text" id="brigade" value="Ù„ÙˆØ§Ø¡ 306"></div>
                <div><label>Ø§Ù„ÙÙˆØ¬</label><select id="fowj"><option>Ø§Ù„Ø£ÙˆÙ„</option><option>Ø§Ù„Ø«Ø§Ù†ÙŠ</option><option>Ø§Ù„Ø«Ø§Ù„Ø«</option><option>Ø§Ù„Ø±Ø§Ø¨Ø¹</option><option>Ø§Ù„Ø®Ø§Ù…Ø³</option><option>Ø§Ù„Ø³Ø§Ø¯Ø³</option><option>Ø§Ù„Ø³Ø§Ø¨Ø¹</option></select></div>
                <div><label>Ø±Ù‚Ù… Ø§Ù„Ø³Ø±ÙŠØ©</label><input type="number" id="sariyaNum"></div>
                <div><label>Ø§Ù„ØµÙ†Ù</label><input type="text" id="cat"></div>
                <div><label>Ø§Ù„Ø®Ø¨Ø±Ø§Øª Ø§Ù„Ø¹Ø³ÙƒØ±ÙŠØ©</label><input type="text" id="exp"></div>
                <div><label>Ø§Ù„Ù…Ø¹Ø±Ù</label><input type="text" id="refN"></div>
                <div><label>Ù‡Ø§ØªÙ Ø§Ù„Ù…Ø¹Ø±Ù</label><input type="number" id="refP"></div>
                <div><label>Ø§Ø³Ù… Ø§Ù„Ø³Ø±ÙŠØ©</label><input type="text" id="sariyaName"></div>
                <textarea id="notes" placeholder="Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©..." style="grid-column: span 2"></textarea>
            </div>
            <div class="admin-only" style="text-align:center;">
                <button type="submit" class="btn" style="background:var(--main-color); padding:12px 80px;">Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</button>
            </div>
        </form>

        <div class="action-bar">
            <input type="text" id="sInp" placeholder="ğŸ” Ø§Ø¨Ø­Ø« Ø¨Ø§Ù„Ø§Ø³Ù… Ø£Ùˆ ID..." onkeyup="doSearch(this.value)" style="width:100%; padding:15px; border-radius:8px; border:1px solid #ddd;">
            <div id="results" style="display:none; margin-top:10px; background:white; border:1px solid #ccc;"></div>
        </div>

        <div class="admin-only" style="display:flex; justify-content:space-between;">
            <button onclick="togglePen()" id="pBtn" class="btn" style="background:black">Ø³Ø¬Ù„ Ø§Ù„Ø¹Ù‚ÙˆØ¨Ø§Øª âš–ï¸</button>
            <button onclick="exportCSV()" class="btn" style="background:#2e7d32">ØªØµØ¯ÙŠØ± Ø¨ÙŠØ§Ù†Ø§Øª</button>
        </div>
    </div>
</div>

<script>
    // --- Ù…Ù†Ø·Ù‚ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…Ø­Ø¯Ø« ÙˆØ§Ù„Ù…Ø¶Ù…ÙˆÙ† ---
    const users = {'admin':'1234', 'user1':'1234'};
    const entryBtn = document.getElementById('entryBtn');

    // Ø§Ø³ØªØ®Ø¯Ø§Ù… EventListener Ø¨Ø¯Ù„Ø§Ù‹ Ù…Ù† onclick Ø§Ù„Ø¹Ø§Ø¯ÙŠ Ù„Ø¶Ù…Ø§Ù† Ø§Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø© ÙÙŠ PC
    entryBtn.addEventListener('click', function() {
        const u = document.getElementById('uInp').value;
        const p = document.getElementById('pInp').value;

        if (p === 'RESET306' || (users[u] && users[u] === p)) {
            let role = (u === 'admin' || p === 'RESET306') ? 'admin' : 'user';
            
            // Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ù„Ø­ÙØ¸
            try {
                if(document.getElementById('remMe').checked) localStorage.setItem('306_role', role);
            } catch(e) { console.log("Storage Blocked"); }
            
            startSystem(role);
        } else {
            alert("Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯Ø®ÙˆÙ„ ØºÙŠØ± ØµØ­ÙŠØ­Ø©");
        }
    });

    function startSystem(role) {
        document.getElementById('loginPage').style.display = 'none';
        document.getElementById('mainContent').style.display = 'block';
        if (role === 'admin') {
            document.querySelectorAll('.admin-only').forEach(el => el.style.display = 'block');
        }
    }

    // Ø§Ù„ØªØ­Ù‚Ù‚ Ø¹Ù†Ø¯ ÙØªØ­ Ø§Ù„ØµÙØ­Ø©
    window.onload = function() {
        try {
            const saved = localStorage.getItem('306_role');
            if(saved) startSystem(saved);
        } catch(e) {}
    };

    function logout() {
        try { localStorage.removeItem('306_role'); } catch(e) {}
        location.reload();
    }

    // --- Ø¨Ù‚ÙŠØ© Ø§Ù„Ø¯ÙˆØ§Ù„ (Ø§Ù„Ø¨Ø­Ø« ÙˆØ§Ù„Ø­ÙØ¸) ÙƒÙ…Ø§ Ù‡ÙŠ Ù…Ø¹ ØªØ­Ø³ÙŠÙ†Ø§Øª Ø¨Ø³ÙŠØ·Ø© ---
    const flds = ["idNo","fullName","birthDate","birthPlace","gender","motherName","natId","marital","spouse","kids","edu","spec","job","prov","dist","subDist","region","mahala","zuqaq","dar","point","phone","brigade","fowj","sariyaNum","cat","exp","refN","refP","sariyaName","notes"];

    document.getElementById('mainForm').onsubmit = function(e) {
        e.preventDefault();
        let db = JSON.parse(localStorage.getItem('db_306') || '[]');
        let data = {}; flds.forEach(f => data[f] = document.getElementById(f).value);
        db.push(data);
        localStorage.setItem('db_306', JSON.stringify(db));
        alert("ØªÙ… Ø§Ù„Ø­ÙØ¸"); this.reset();
    };

    function doSearch(val) {
        if(val.length < 2) return;
        let db = JSON.parse(localStorage.getItem('db_306') || '[]');
        let res = db.filter(i => i.fullName.includes(val) || i.idNo.includes(val));
        // Ù‡Ù†Ø§ ÙŠÙ…ÙƒÙ†Ùƒ Ø¥Ø¶Ø§ÙØ© Ù…Ù†Ø·Ù‚ Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªØ§Ø¦Ø¬
    }

    function exportCSV() {
        let db = JSON.parse(localStorage.getItem('db_306') || '[]');
        let csv = "\uFEFF" + flds.join(",") + "\n";
        db.forEach(row => { csv += flds.map(f => `"${row[f]||''}"`).join(",") + "\n"; });
        let blob = new Blob([csv], {type:'text/csv;charset=utf-8'});
        let a = document.createElement('a'); a.href=URL.createObjectURL(blob); a.download="data.csv"; a.click();
    }
</script>
</body>
</html>
