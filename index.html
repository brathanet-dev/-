<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>Ù†Ø¸Ø§Ù… Ø§Ù„Ø¹Ø¯ÙŠØ¯ Ø§Ù„Ù…Ø±ÙƒØ²ÙŠ - Ù„ÙˆØ§Ø¡ 306</title>

<style>
:root{--main:#1b5e20}
body{font-family:Segoe UI;background:#f4f4f9;margin:0;direction:rtl}
.container{max-width:1300px;margin:20px auto;background:#fff;padding:25px;border-radius:15px}
.btn{padding:8px 14px;border:none;border-radius:5px;color:#fff;cursor:pointer}
.btn-main{background:var(--main);width:100%}
.hidden{display:none}
input,select{padding:8px;border:1px solid #ccc;border-radius:5px;width:100%}
table{width:100%;border-collapse:collapse;margin-top:15px}
th,td{border:1px solid #ccc;padding:6px;text-align:center;font-size:13px}
th{background:#2e7d32;color:#fff}
</style>
</head>

<body>

<!-- LOGIN -->
<div id="login" style="position:fixed;inset:0;background:#0d1b16;display:flex;justify-content:center;align-items:center">
<div style="background:#fff;padding:25px;border-radius:12px;width:300px;text-align:center">
<h3>ğŸ” ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</h3>
<input id="lu" placeholder="Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…">
<input id="lp" type="password" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
<button class="btn btn-main" onclick="login()">Ø¯Ø®ÙˆÙ„</button>
<p id="le" style="color:red;display:none">Ø®Ø·Ø£ Ø¨Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</p>
</div>
</div>

<!-- APP -->
<div class="container hidden" id="app">

<h2>Ù†Ø¸Ø§Ù… Ø§Ù„Ø¹Ø¯ÙŠØ¯ Ø§Ù„Ù…Ø±ÙƒØ²ÙŠ</h2>
<p id="who"></p>

<form onsubmit="saveData(event)">
<input id="name" placeholder="Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„" required>
<input id="nid" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù‡ÙˆÙŠØ©">
<input id="phone" placeholder="Ø§Ù„Ù‡Ø§ØªÙ">
<input id="fowj" placeholder="Ø§Ù„ÙÙˆØ¬">
<button class="btn btn-main">Ø­ÙØ¸</button>
</form>

<div style="margin-top:15px">
<button onclick="showStats()" class="btn" style="background:#6a1b9a">ğŸ“Š Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª</button>
<button onclick="logout()" class="btn" style="background:#444">ğŸšª Ø®Ø±ÙˆØ¬</button>
</div>

<table id="tbl"></table>

</div>

<!-- STATS -->
<div id="stats" class="hidden" style="position:fixed;inset:0;background:#0008;display:flex;align-items:center;justify-content:center">
<div style="background:#fff;padding:20px;border-radius:12px;width:400px">
<div id="statsContent"></div>
<button onclick="stats.classList.add('hidden')" class="btn" style="background:red;width:100%">Ø¥ØºÙ„Ø§Ù‚</button>
</div>
</div>

<script>
/* ====== Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª ====== */
const DB="db306";
const LOG="db306_logs";
const USERS="db306_users";
let currentUser=null;
let lastActivity=Date.now();

/* ====== ØªØ´ÙÙŠØ± ====== */
async function hash(t){
const e=new TextEncoder().encode(t);
const h=await crypto.subtle.digest("SHA-256",e);
return Array.from(new Uint8Array(h)).map(b=>b.toString(16).padStart(2,"0")).join("");
}

/* ====== Ù…Ø³ØªØ®Ø¯Ù… Ø§ÙØªØ±Ø§Ø¶ÙŠ ====== */
(async()=>{
if(!localStorage.getItem(USERS)){
localStorage.setItem(USERS,JSON.stringify([
{u:"admin",p:await hash("1234"),r:"admin"}
]));
}
})();

/* ====== Login ====== */
async function login(){
const u=lu.value,p=lp.value;
const users=JSON.parse(localStorage.getItem(USERS));
const h=await hash(p);
const f=users.find(x=>x.u===u&&x.p===h);
if(!f){le.style.display="block";return;}
currentUser=f;
login.style.display="none";
app.classList.remove("hidden");
who.innerText=`ğŸ‘¤ ${f.u} (${f.r})`;
render();
}

/* ====== Logout + Timeout ====== */
function logout(){location.reload();}
setInterval(()=>{
if(Date.now()-lastActivity>600000) logout();
},10000);
document.onclick=()=>lastActivity=Date.now();

/* ====== Ø­ÙØ¸ ====== */
function saveData(e){
e.preventDefault();
if(currentUser.r==="viewer") return alert("ØºÙŠØ± Ù…ØµØ±Ø­");
let db=JSON.parse(localStorage.getItem(DB)||"[]");
if(db.some(x=>x.name===name.value&&x.nid===nid.value&&x.phone===phone.value))
return alert("âŒ Ø³Ø¬Ù„ Ù…ÙƒØ±Ø±");
let obj={name:name.value,nid:nid.value,phone:phone.value,fowj:fowj.value,status:"active"};
db.push(obj);
localStorage.setItem(DB,JSON.stringify(db));
log(`Ø¥Ø¶Ø§ÙØ© ${obj.name}`);
e.target.reset();
render();
}

/* ====== Ø¹Ø±Ø¶ ====== */
function render(){
let db=JSON.parse(localStorage.getItem(DB)||"[]");
tbl.innerHTML="<tr><th>Ø§Ù„Ø§Ø³Ù…</th><th>Ø§Ù„Ù‡ÙˆÙŠØ©</th><th>Ø§Ù„Ù‡Ø§ØªÙ</th><th>Ø§Ù„ÙÙˆØ¬</th></tr>"+
db.map(x=>`<tr><td>${x.name}</td><td>${x.nid}</td><td>${x.phone}</td><td>${x.fowj}</td></tr>`).join("");
}

/* ====== Logs ====== */
function log(txt){
let l=JSON.parse(localStorage.getItem(LOG)||"[]");
l.push({u:currentUser.u,t:new Date().toLocaleString(),a:txt});
localStorage.setItem(LOG,JSON.stringify(l));
}

/* ====== Stats ====== */
function showStats(){
let db=JSON.parse(localStorage.getItem(DB)||"[]");
let byF={};
db.forEach(x=>byF[x.fowj]=(byF[x.fowj]||0)+1);
let h=`<h3>ğŸ“Š Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª</h3><p>Ø§Ù„ÙƒÙ„: ${db.length}</p><ul>`;
for(let k in byF) h+=`<li>${k||"ØºÙŠØ± Ù…Ø­Ø¯Ø¯"}: ${byF[k]}</li>`;
h+="</ul>";
statsContent.innerHTML=h;
stats.classList.remove("hidden");
}
</script>

</body>
</html>
