<th>Ø§Ù„ÙÙˆØ¬</th><th>Ø±Ù‚Ù… Ø§Ù„Ø³Ø±ÙŠØ©</th><th>Ø§Ù„ØµÙ†Ù</th><th>Ø§Ù„Ø®Ø¨Ø±Ø§Øª</th>
        <th>Ø§Ù„Ù…Ø¹Ø±Ù</th><th>Ù‡Ø§ØªÙ Ø§Ù„Ù…Ø¹Ø±Ù</th><th>Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª</th><th>Ø§Ø³Ù… Ø§Ù„Ø³Ø±ÙŠØ©</th>
        <th>Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
</div>

<!-- Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¹Ù‚ÙˆØ¨Ø§Øª -->
<div class="page hidden" id="punishmentPage">
  <h1>Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¹Ù‚ÙˆØ¨Ø§Øª</h1>
  <table id="punishmentTable">
    <thead>
      <tr>
        <th>ID</th><th>Ø§Ù„Ø§Ø³Ù…</th><th>Ø§Ù„ÙÙˆØ¬</th><th>Ø±Ù‚Ù… Ø§Ù„Ø³Ø±ÙŠØ©</th><th>Ø§Ø³Ù… Ø§Ù„Ø³Ø±ÙŠØ©</th><th>Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
  <button class="btn no-print" onclick="backToMain()">Ø±Ø¬ÙˆØ¹ Ù„Ù„Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</button>
</div>

<!-- ØµÙØ­Ø© Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª -->
<div class="page hidden" id="settingsPage">
  <h1>Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª ÙˆØ§Ù„Ø³Ù…Ø§Øª</h1>
  <h3>ØªØºÙŠÙŠØ± Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯Ø®ÙˆÙ„</h3>
  <label>Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ù‚Ø¯ÙŠÙ…</label><input type="text" id="oldUser"><br>
  <label>ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©</label><input type="password" id="oldPass"><br>
  <label>Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø¬Ø¯ÙŠØ¯</label><input type="text" id="newUser"><br>
  <label>ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©</label><input type="password" id="newPass"><br>
  <button class="btn" onclick="changeLogin()">ØªØºÙŠÙŠØ±</button>

  <h3>ØªØºÙŠÙŠØ± Ø§Ù„Ù„ÙˆÙ† Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ</h3>
  <input type="color" id="colorPicker" onchange="changeColor()">

  <h3>Ø¥Ø¶Ø§ÙØ© ØµÙˆØ±Ø© Ø®Ù„ÙÙŠØ©</h3>
  <input type="file" id="bgUpload" accept="image/*" onchange="setBackground(event)">

  <h3>Ø¥Ø¶Ø§ÙØ© Ø¹Ù„Ø§Ù…Ø© Ù…Ø§Ø¦ÙŠØ© Ù„Ù„Ø·Ø¨Ø§Ø¹Ø©</h3>
  <input type="file" id="wmUpload" accept="image/*" onchange="setWatermark(event)">
  <button class="btn no-print" onclick="backToMain()">Ø±Ø¬ÙˆØ¹</button>
</div>

<script>
  let currentUser = "admin";
  let currentPass = "1234";

  function login(){
    const user=document.getElementById("username").value;
    const pass=document.getElementById("password").value;
    if(user===currentUser && pass===currentPass){
      document.getElementById("loginPage").classList.add("hidden");
      document.getElementById("dataPage").classList.remove("hidden");
    } else { alert("Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯Ø®ÙˆÙ„ ØºÙŠØ± ØµØ­ÙŠØ­Ø©"); }
  }

  function saveData(){
    const fields=["id","fullName","birthDate","birthPlace","gender","motherName","natId","marital","spouse","kids",
      "edu","spec","job","prov","dist","subDist","region","mahala","zuqaq","dar","point","phone",
      "brigade","regiment","companyNo","class","exp","ref","refPhone","notes","companyName"];
    const row=document.createElement("tr");
    fields.forEach(f=>{
      const td=document.createElement("td");
      td.textContent=document.getElementById(f).value;
      row.appendChild(td);
    });
    const actionTd=document.createElement("td");
    const punishBtn=document.createElement("button");
    punishBtn.textContent="Ø¥Ø±Ø³Ø§Ù„ Ù„Ù„Ø¹Ù‚ÙˆØ¨Ø§Øª";
    punishBtn.className="btn";
    punishBtn.onclick=()=>moveToPunishments(row);
    actionTd.appendChild(punishBtn);
    row.appendChild(actionTd);
    document.querySelector("#mainTable tbody").appendChild(row);
    highlightDuplicates();
    alert("ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª âœ…");
  }

  function moveToPunishments(row){
    const clone=row.cloneNode(true);
    const actionTd=clone.lastChild;
    actionTd.innerHTML="";
    const liftBtn=document.createElement("button");
    liftBtn.textContent="Ø±ÙØ¹ Ø§Ù„Ø¹Ù‚ÙˆØ¨Ø©";
    liftBtn.className="btn";
    liftBtn.onclick=()=>moveBackToMain(clone);
    actionTd.appendChild(liftBtn);
    document.querySelector("#punishmentTable tbody").appendChild(clone);
    row.remove();
  }

  function moveBackToMain(row){
    const clone=row.cloneNode(true);
    const actionTd=clone.lastChild;
    actionTd.innerHTML="";
    const punishBtn=document.createElement("button");
    punishBtn.textContent="Ø¥Ø±Ø³Ø§Ù„ Ù„Ù„Ø¹Ù‚ÙˆØ¨Ø§Øª";
    punishBtn.className="btn";
    punishBtn.onclick=()=>moveToPunishments(clone);
    actionTd.appendChild(punishBtn);
    document.querySelector("#mainTable tbody").appendChild(clone);
    row.remove();
  }

  function showPunishments(){
    document.getElementById("dataPage").classList.add("hidden");
    document.getElementById("punishmentPage").classList.remove("hidden");
  }
  function backToMain(){
    document.getElementById("punishmentPage").classList.add("hidden");
    document.getElementById("settingsPage").classList.add("hidden");
    document.getElementById("dataPage").classList.remove("hidden");
  }
  function showSettings(){
    document.getElementById("dataPage").classList.add("hidden");
    document.getElementById("settingsPage").classList.remove("hidden");
  }

  function filterTable(field){
    const input=document.getElementById("filter"+field.charAt(0).toUpperCase()+field.slice(1)).value.toLowerCase();
    const rows=document.querySelectorAll("#mainTable tbody tr");
    rows.forEach(r=>{
      let match=false;
      r.querySelectorAll("td").forEach(c=>{
        if(c.textContent.toLowerCase().includes(input)) match=true;
      });
      r.style.display=match?"":"none";
    });
  }

  function highlightDuplicates(){
    const names={};
    const rows=document.querySelectorAll("#mainTable tbody tr");
    rows.forEach(r=>{
      const name=r.children[1].textContent.trim();
      if(names[name]){
        r.style.backgroundColor="#ffebee";
        r.style.color="#c62828";
        names[name].style.backgroundColor="#ffebee";
        names[name].style.color="#c62828";
      } else { names[name]=r; }
    });
  }

  function searchNames(){
    const input=document.getElementById("searchInput").value.toLowerCase();
    const dropdown=document.getElementById("searchDropdown");
    dropdown.innerHTML="";
    if(input===""){ dropdown.style.display="none"; return; }
    const rows=document.querySelectorAll("#mainTable tbody tr");
    rows.forEach(r=>{
      const name=r.children[1].textContent.toLowerCase();
      if(name.includes(input)){
        const item=document.createElement("div");
        item.textContent=r.children[1].textContent;
        item.style.padding="5px"; item.style.cursor="pointer";
        item.onclick=()=>fillForm(r);
        dropdown.appendChild(item);
      }
    });
    dropdown.style.display=dropdown.innerHTML===""?"none":"block";
  }

  function fillForm(row){
    const fields=["id","fullName","birthDate","birthPlace","gender","motherName","natId","marital","spouse","kids",
      "edu","spec","job","prov","dist","subDist","region","mahala","zuqaq","dar","point","phone",
      "brigade","regiment","companyNo","class","exp","ref","refPhone","notes","companyName"];
    fields.forEach((f,i)=>{ document.getElementById(f).value=row.children[i].textContent; });
    document.getElementById("searchDropdown").style.display="none";
  }

  function changeLogin(){
    const oldU=document.getElementById("oldUser").value;
    const oldP=document.getElementById("oldPass").value;
    const newU=document.getElementById("newUser").value;
    const newP=document.getElementById("newPass").value;
    if(oldU===currentUser && oldP===currentPass){
      currentUser=newU; currentPass=newP;
      alert("ØªÙ… ØªØºÙŠÙŠØ± Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯Ø®ÙˆÙ„ âœ…");
    } else { alert("Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø© ØºÙŠØ± ØµØ­ÙŠØ­Ø© âŒ"); }
  }

  function changeColor(){
    const color=document.getElementById("colorPicker").value;
    document.documentElement.style.setProperty("--main-color",color);
    alert("ØªÙ… ØªØºÙŠÙŠØ± Ø§Ù„Ù„ÙˆÙ† Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ ğŸ¨");
  }

  function setBackground(event){
    const file=event.target.files[0];
    if(file){
      const reader=new FileReader();
      reader.onload=function(e){
        document.body.style.backgroundImage=`url(${e.target.result})`;
        document.body.style.backgroundSize="cover";
      }
      reader.readAsDataURL(file);
    }
  }

  function setWatermark(event){
    const file=event.target.files[0];
    if(file){
      const reader=new FileReader();
      reader.onload=function(e){
        const wm=document.createElement("img");
        wm.src=e.target.result;
        wm.className="print-watermark
